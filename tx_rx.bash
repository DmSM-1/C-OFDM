#!/bin/bash

# 1. –ó–∞–ø—É—Å–∫–∞–µ–º tx –≤ —Ñ–æ–Ω–µ
./tx &

# –°–æ—Ö—Ä–∞–Ω—è–µ–º PID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
TX_PID=$!

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º rx –≤ foreground (—Å–∫—Ä–∏–ø—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å)
nice -n -10 ./rx 

# --------------------------------------------------------
## –°–µ–∫—Ü–∏—è –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–Ø (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ./rx)
# --------------------------------------------------------

echo "–ü—Ä–æ—Ü–µ—Å—Å rx –∑–∞–≤–µ—Ä—à–µ–Ω. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É–Ω–∏—á—Ç–æ–∂–∞–µ–º tx (PID: $TX_PID)..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Å –¥–∞–Ω–Ω—ã–º PID (kill -0)
if kill -0 $TX_PID 2>/dev/null; then
    
    echo "üí• –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –º—è–≥–∫–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (SIGTERM)..."
    # –®–∞–≥ 1: –ú—è–≥–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —á—Ç–æ–±—ã –¥–∞—Ç—å tx –≤—Ä–µ–º—è –Ω–∞ –æ—á–∏—Å—Ç–∫—É
    kill -SIGTERM $TX_PID
    
    sleep 1 # –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É
    
    # –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å–ª–µ SIGTERM
    if kill -0 $TX_PID 2>/dev/null; then
        echo "üî• tx –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–Ω–∏—á—Ç–æ–∂–∞–µ–º (SIGKILL)..."
        # –®–∞–≥ 3: –ñ–µ—Å—Ç–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –µ—Å–ª–∏ SIGTERM –Ω–µ –ø–æ–º–æ–≥
        kill -SIGKILL $TX_PID
    else
        echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å tx –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ."
    fi

else
    echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å tx (PID: $TX_PID) —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ."
fi

echo "–°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω."